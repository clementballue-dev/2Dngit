<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Shooter IA</title>
<style>
  html,body{
    margin:0;
    padding:0;
    overflow:hidden;
  }
  #playBtn{
    position:fixed;
    bottom:20px;
    right:20px;
    padding:15px 25px;
    font-size:18px;
    cursor:pointer;
  }
  #overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.8);
    color:white;
    display:none;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    font-size:48px;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>
<button id="playBtn">JOUER</button>

<div id="overlay">
  <div id="result"></div>
  <button onclick="location.reload()">REJOUER</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// ================= FOND ALEATOIRE =================
const mapColors = [
  "#4da6ff", // bleu
  "#4caf50", // vert
  "#9c27b0", // violet
  "#ff9800", // orange
  "#607d8b", // gris bleu
  "#795548", // marron
  "#009688"  // turquoise
];

let bgColor = mapColors[Math.floor(Math.random()*mapColors.length)];

// ================= CONTROLES =================
const keys = {};
addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

let playing = false;

// ================= JOUEUR =================
const player = {
  x:canvas.width/2,
  y:canvas.height/2,
  size:40,
  speed:5
};

// ================= ENNEMI =================
const enemy = {
  x:200,
  y:200,
  size:40,
  life:3,
  maxLife:3,
  dx:1,
  dy:1,
  shootCooldown:60
};

// ================= BALLES =================
let bullets = [];
let enemyBullets = [];

// ================= MOVE =================
function movePlayer(){
  if(keys["z"]) player.y -= player.speed;
  if(keys["s"]) player.y += player.speed;
  if(keys["q"]) player.x -= player.speed;
  if(keys["d"]) player.x += player.speed;
}

// ================= IA ENNEMIE =================
function enemyAI(){
  if(Math.random()<0.01){
    enemy.dx = Math.random()*2-1;
    enemy.dy = Math.random()*2-1;
  }
  enemy.x += enemy.dx*2;
  enemy.y += enemy.dy*2;

  if(enemy.x<50||enemy.x>canvas.width-50) enemy.dx*=-1;
  if(enemy.y<50||enemy.y>canvas.height-50) enemy.dy*=-1;

  enemy.shootCooldown--;
  if(enemy.shootCooldown<=0){
    shootEnemy();
    enemy.shootCooldown = 60 + Math.random()*60;
  }
}

function shootEnemy(){
  const dx = player.x - enemy.x;
  const dy = player.y - enemy.y;
  const d = Math.hypot(dx,dy);
  enemyBullets.push({
    x:enemy.x+enemy.size/2,
    y:enemy.y+enemy.size/2,
    vx:(dx/d)*5,
    vy:(dy/d)*5
  });
}

// ================= SHOOT PLAYER =================
addEventListener("click",()=>{
  if(!playing) return;
  bullets.push({
    x:player.x+player.size,
    y:player.y+player.size/2,
    vx:8
  });
});

// ================= DRAW =================
function drawPlayer(){
  ctx.fillStyle="#222";
  ctx.fillRect(player.x,player.y,player.size,player.size);
}

function drawEnemy(){
  ctx.fillStyle="red";
  ctx.fillRect(enemy.x,enemy.y,enemy.size,enemy.size);

  ctx.fillStyle="black";
  ctx.fillRect(enemy.x,enemy.y-8,enemy.size,5);
  ctx.fillStyle="lime";
  ctx.fillRect(enemy.x,enemy.y-8,enemy.size*(enemy.life/enemy.maxLife),5);
}

function drawBullets(){
  ctx.fillStyle="yellow";
  bullets.forEach((b,i)=>{
    b.x+=b.vx;
    ctx.fillRect(b.x,b.y,8,4);
    if(b.x>enemy.x&&b.x<enemy.x+enemy.size&&b.y>enemy.y&&b.y<enemy.y+enemy.size){
      enemy.life--;
      bullets.splice(i,1);
      if(enemy.life<=0) win();
    }
  });

  ctx.fillStyle="orange";
  enemyBullets.forEach((b)=>{
    b.x+=b.vx;
    b.y+=b.vy;
    ctx.fillRect(b.x,b.y,6,6);
    if(b.x>player.x&&b.x<player.x+player.size&&b.y>player.y&&b.y<player.y+player.size){
      lose();
    }
  });
}

// ================= FIN =================
function win(){ end("VICTOIRE ðŸ†"); }
function lose(){ end("DÃ‰FAITE â˜ ï¸"); }
function end(txt){
  playing=false;
  result.textContent=txt;
  overlay.style.display="flex";
}

// ================= LOOP =================
function loop(){
  ctx.fillStyle = bgColor;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(playing){
    movePlayer();
    enemyAI();
    drawPlayer();
    drawEnemy();
    drawBullets();
  }
  requestAnimationFrame(loop);
}
loop();

// ================= START =================
playBtn.onclick=()=>{
  playing=true;
  playBtn.style.display="none";
};
</script>

</body>
</html>

